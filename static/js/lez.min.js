"use strict";var input_button=$("#btn-input"),input_field=$("#input-value"),input_title=$("#input-title"),btn_yes=$("#btn-yes"),btn_notnow=$("#btn-notnow"),btn_no=$("#btn-no"),btn_login=$(".btn-login"),btn_register=$("#register"),btn_login_email=$("#btn-login-email"),btn_signup=$("#btn-signup"),btn_reset=$("#btn-reset"),login_shade=$("#login-shade"),login_email=$("#email-login"),title="My List",lists=[],list=[],suggestion=null,auth_mode=null,list_id=null,suggested=[],shuffle=function(c){for(var d=c.length-1;0<d;d--){var f=Math.floor(Math.random()*(d+1)),_ref=[c[f],c[d]];c[d]=_ref[0],c[f]=_ref[1]}return c},url_pattern=/^(http|https):\/\/[^ "<>]+$/,is_url=function(c){return url_pattern.test(c)};window.gauth_login=function(){is_logged_in=!0};var gauth_cleanup=function(){var c=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0;setTimeout(function(){$("#login-shade section").show()},500),login_shade.removeClass("visible"),set_logged_in(),c&&get_lists()},get_csrf_token=function(){var c=null,d="csrftoken";return document.cookie&&""!=document.cookie&&document.cookie.split(";").map(function(f){f=f.trim(),f.substring(0,d.length+1)==d+"="&&(c=decodeURIComponent(f.substring(d.length+1)))}),c},show_splash=function(){$("#output > div").removeClass("visible"),$("#output .splash").addClass("visible")},show_cover=function(){$("#output > div").removeClass("visible"),$("#output .cover").addClass("visible")},get_next=function(){var c=shuffle(list.filter(function(d){return 0>suggested.indexOf(d.value)}));return c.length?void(suggestion=c[0],is_url(suggestion.value)?$("#suggestion").html("<a target=\"_blank\" href=\""+suggestion.value+"\">"+suggestion.value.split("//")[1]+"</a> <i class=\"fa fa-external-link\"></i>"):$("#suggestion").text(suggestion.value),$("#output > div").removeClass("visible"),$("#output .suggest").addClass("visible")):($("#output > div").removeClass("visible"),void(list.length?$("#output .no-suggestions").addClass("visible"):$("#output .no-items").addClass("visible")))},save_local=function(){localStorage.last_update=new Date().valueOf(),localStorage.list_items=JSON.stringify(list),list_id&&(localStorage.list_id=list_id)},save_title=function(){input_title.removeClass("editing");var c=input_title.val();return c?void(c===title||($.ajax({url:"api/lists/"+list_id+"/modify/",method:"post",data:{csrfmiddlewaretoken:get_csrf_token(),title:c}}),lists=lists.map(function(d){return d.id==list_id&&(d.title=c),d}),title=c)):void input_title.val(title)},input_message_timer=null,enter_value=function(){var c=input_field.val();return""===c?($(".input-messages").addClass("visible error").text("Be a bit more creative than that!"),clearInterval(input_message_timer),void(input_message_timer=setTimeout(function(){$(".input-messages").removeClass("visible error")},2e3))):0<=list.map(function(d){return d.value}).indexOf(c)?($(".input-messages").addClass("visible error").text("You already added that!"),clearInterval(input_message_timer),void(input_message_timer=setTimeout(function(){$(".input-messages").removeClass("visible error")},2e3))):void(is_logged_in?$.ajax({url:"api/lists/"+list_id+"/add/",method:"post",data:{value:c,csrfmiddlewaretoken:get_csrf_token()},success:function success(d){list.push({value:c,id:d.id}),save_local(),1===list.length&&show_cover()}}):(list.push({value:c,id:0}),save_local(),1===list.length&&show_cover()),$(".input-messages").removeClass("error").addClass("visible").text("Added "+c+" to "+title),clearInterval(input_message_timer),input_message_timer=setTimeout(function(){$(".input-messages").removeClass("visible")},2e3),input_field.val(""))},remove_item=function(){is_logged_in?$.ajax({url:"api/lists/"+list_id+"/"+suggestion.id+"/remove/",method:"post",data:{csrfmiddlewaretoken:get_csrf_token()},success:function success(){list=list.filter(function(d){return d.value!==suggestion.value}),save_local(),get_next()}}):(list=list.filter(function(c){return c.value!==suggestion.value}),save_local(),get_next())},get_lists=function(c){$.ajax({url:"api/lists/",method:"get",success:function success(d){lists=d.lists,c&&c()}})},get_list=function(c){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;$.ajax({url:"api/lists/"+c+"/",method:"get",success:function success(f){list_id=c,list=f.values,title=f.title,input_title.val(title),list.length?show_cover():$("#output > div").removeClass("visible"),save_local(),d&&d()}})},show_list_list=function(){var c=$("<ul>");lists.map(function(d){var f=d.id==list_id?"<i class=\"fa fa-check\"></i> ":"";c.append("<li data-id=\""+d.id+"\">"+f+d.title+"</li>")}),c.append("<li><i class=\"fa fa-plus\"></i> Add New List</li>"),$(".list-container").html(c),$(".list-container li").on("click",function(){var d=$(this).attr("data-id");d?(get_list(d),$(".shade").removeClass("visible")):$.ajax({url:"api/lists/add/",method:"post",data:{title:"New List",items:JSON.stringify([]),csrfmiddlewaretoken:get_csrf_token()},success:function success(f){list_id=f.id,get_list(list_id,function(){$("#output > div").removeClass("visible"),$(".shade").removeClass("visible"),$("#input-title").focus()})}})})},set_logged_in=function(){$("body").addClass("logged-in")},set_logged_out=function(){$("body").removeClass("logged-in")},set_auth_mode=function(c){auth_mode=c,$(".login-reg").text(c),$(".btn-select-login").removeClass("active"),$(".btn-select-login[data-type="+c+"]").addClass("active")},init=function(){localStorage.last_update?(title=localStorage.list_title,list=JSON.parse(localStorage.list_items),list_id=localStorage.list_id,list.length&&!is_logged_in?show_cover():!is_logged_in&&show_splash()):(localStorage.last_update=new Date().valueOf(),localStorage.list_title=title,localStorage.list_items=JSON.stringify(list),list_id&&(localStorage.list_id=list_id)),is_logged_in||input_title.val(title),is_logged_in?set_logged_in():set_logged_out(),is_logged_in&&(list_id?(get_list(list_id),get_lists()):get_lists(function(){list_id=lists.sort(function(c,d){return new Date(c.modified)-new Date(d.modified)})[0].id,get_list(list_id)}))};$(document).ready(function(){init(),input_title.on("focus",function(){input_title.addClass("editing")}).on("blur",function(){save_title()}).on("keypress",function(c){13===(c.charCode||c.keyCode)&&input_title.blur()}),input_field.on("keypress",function(c){13===(c.charCode||c.keyCode)&&enter_value()}),input_button.on("click",function(){enter_value()}),$("#btn-suggest").on("click",function(){get_next()}),btn_reset.on("click",function(c){c.preventDefault(),suggested=[],get_next()}),btn_yes.on("click",function(){remove_item()}),btn_notnow.on("click",function(){suggested.push(suggestion.value),get_next()}),btn_no.on("click",function(){remove_item()}),$(".btn-select-login").on("click",function(c){c.preventDefault(),set_auth_mode($(this).attr("data-type"))}),btn_login.on("click",function(){set_auth_mode("login"),login_shade.addClass("visible")}),$(".shade").on("click",function(c){"div"===c.target.tagName.toLowerCase()&&$(".shade").removeClass("visible")}),$("#btn-donate").on("click",function(){$("#donate-shade").addClass("visible")}),$("#btn-list-select").on("click",function(){show_list_list(),$("#list-list").addClass("visible")}),btn_login_email.on("click",function(){btn_login_email.addClass("active"),login_email.addClass("visible"),$("#login-email").focus()}),btn_register.on("click",function(){set_auth_mode("register"),login_shade.addClass("visible")}),$("#login-password").on("keypress",function(c){13===(c.charCode||c.keyCode)&&btn_signup.click()}),btn_signup.on("click",function(){$("input").prop("disabled",!0),btn_signup.prop("disabled",!0),$.ajax({url:"/"+auth_mode+"/",method:"post",data:{email:$("#login-email").val(),password:$("#login-password").val(),csrfmiddlewaretoken:get_csrf_token()},success:function success(c){c.success?($(".form-errors").html(""),is_logged_in=!0,set_logged_in(),"register"===auth_mode?$.ajax({url:"api/lists/add/",method:"post",data:{title:title,items:JSON.stringify(list),csrfmiddlewaretoken:get_csrf_token()},success:function success(d){list_id=d.id,get_lists()}}):list_id?get_list(list_id):list.length?$.ajax({url:"api/lists/add/",method:"post",data:{title:title,items:JSON.stringify(list),csrfmiddlewaretoken:get_csrf_token()},success:function success(d){list_id=d.id,get_lists()}}):get_list(c.lists.sort(function(d,f){return new Date(d.modified)-new Date(f.modified)})[0].id),login_shade.removeClass("visible")):["email","password","all"].map(function(d){c.errors[d]&&$("#login-"+d+"-errors").html(c.errors[d].reduce(function(f,g){return f+"<br>"+g},""))})},error:function error(){console.error("registration error")},complete:function complete(){$("input").prop("disabled",!1),btn_signup.prop("disabled",!1)}})}),$(".btn-logout").on("click",function(){Object.keys(localStorage).map(function(c){delete localStorage[c]}),$("#output contents").removeClass("visible"),input_field.val("")}),$("#btn-gauth").on("click",function(){$("#login-shade section").fadeOut();var c=window.open("/social/login/google-oauth2","name","height=600,width=450");window.focus&&c.focus();var d=setInterval(function(){(!c||c.closed)&&(clearInterval(d),is_logged_in?list_id?(get_list(list_id),gauth_cleanup()):get_lists(function(){lists.length?(list_id=lists.sort(function(f,g){return new Date(f.modified)-new Date(g.modified)})[0].id,get_list(list_id),gauth_cleanup(!1)):$.ajax({url:"api/lists/add/",method:"post",data:{title:title,items:JSON.stringify(list),csrfmiddlewaretoken:get_csrf_token()},success:function success(f){list_id=f.id,gauth_cleanup()}})}):$("#login-shade section").fadeIn())},200)})});
